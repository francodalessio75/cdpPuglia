import { Component, Input, OnInit } from '@angular/core';
import { MatDialog, MatDialogConfig } from '@angular/material/dialog';
import { CVE } from 'src/app/_models/cve';
import { Threat } from 'src/app/_models/threat';
import { ThreatsService } from 'src/app/_services/threats.service';
import { CveDetailsComponent } from './cve-details/cve-details.component';

@Component({
  selector: 'app-cve-data',
  templateUrl: './cve-data.component.html',
  styleUrls: ['./cve-data.component.css']
})
export class CveDataComponent {

  @Input() threat!:Threat;
  cve!:CVE;

  constructor( 
    private threatService:ThreatsService,
    private dialog:MatDialog) { 
      this.threatService.currentThreat$.subscribe(
        threat => this.threat = threat
      );
      this.threatService.currentCve$.subscribe(
        cve => { 
          this.cve = cve;
          this.openDialog();
        });
  }

  openCveDetails(cveCode:string){
    this.threatService.setCve(cveCode);
  }

  openDialog(){
    const dialogConfig = new MatDialogConfig();

        dialogConfig.disableClose = true;
        dialogConfig.autoFocus = true;
        dialogConfig.width = '60%';
        dialogConfig.height = '60%';

        dialogConfig.data = {
          data:{
            cveId: this.cve.data.cveId,
            description: this.cve.data.description,
            entity: this.cve.data.entity,
          }
        };

        this.dialog.open(CveDetailsComponent, dialogConfig);
  }
}
